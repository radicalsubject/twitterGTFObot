name: Build and publish
on:
# Trigger the workflow on push or pull request,
  # but only for the main branch
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
    build:
        name: Build for ubuntu-latest
        runs-on: ubuntu-latest
        steps:
# pushing to dockerhub
          - uses: actions/checkout@v2
          - name: Run docker-compose stack
            run: docker-compose -f docker-compose.yml up -d #docker build -t radicalsubject/twittergtfo:v0
          - name: Check folder
            run: pwd
          - name: Check files
            run: ls -ltr 
          - name: build image
            run: docker tag radicalsubject/twittergtfo:v0 radicalsubject/twittergtfo:v0  
          - name: docker login
            run: docker login --username radicalsubject --password dr5[gnhn!
          - name: Upload to release to dockerhub
            run: docker push radicalsubject/twittergtfo:v0 
# pushing directly to dokku
          - uses: actions/checkout@v2
          - name: Build the stack
            run: docker-compose -f docker-compose.yml up -d --build
          - name: Git-remote-add
            run: git remote add remote add dokku dokku@178.176.224.186:bot
          - name: Git-fetch-all
            run: git fetch --all
          - name: push to dokku
            run: git push dokku main
                  
# # build the image
# docker build -t dokku/test-app:v12 .
# # copy the image to the dokku host
# docker save dokku/test-app:v12 | bzip2 | ssh my.dokku.host "bunzip2 | docker load"
# # tag and deploy the image
# ssh my.dokku.host "dokku tags:create test-app previous; dokku tags:deploy test-app v12"